<!--
***********************************************************************************************
Microsoft.CSharpExtension.DesignTime.targets

A polyfill for the real Microsoft.CSharp.DesignTime.targets file that is supplied by the .NET
project system in Visual Studio and the C# Dev Kit extension.
https://github.com/dotnet/project-system/blob/8ba13c7fa917b86462e0ff32a07ef3e15eb8dfa6/src/Microsoft.VisualStudio.ProjectSystem.Managed/ProjectSystem/DesignTimeTargets/Microsoft.CSharp.DesignTime.targets

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

Copyright (c) .NET Foundation. All rights reserved.
***********************************************************************************************
-->

<Project>

    <!--
      If there are any .razor or .cshtml files in this project we want to do three things:

        1. Add a 'ContainsRazorFile' capability to the project so tooling can light up as necessary
        2. Reference the Razor source generator
        3. Add each .razor and .cshtml file to the project as an AdditionalFiles item so the source generator can see it
    -->
  
  <PropertyGroup>
    <_HasRazorOrCshtmlFiles>false</_HasRazorOrCshtmlFiles>
  </PropertyGroup>

  <ItemGroup>
    <!-- Collect all Razor and CSHTML files -->
    <_RazorOrCshtmlFiles Include="**\*.razor;**\*.cshtml" />
  </ItemGroup>

  <Target Name="DetectRazorOrCshtmlFiles" BeforeTargets="AssignProjectConfiguration">
    <PropertyGroup Condition="'@(_RazorOrCshtmlFiles)' != ''">
      <_HasRazorOrCshtmlFiles>true</_HasRazorOrCshtmlFiles>
    </PropertyGroup>
  </Target>

  <PropertyGroup>
    <ProjectCapability Include="ContainsRazorFile" Condition="'$(_HasRazorOrCshtmlFiles)' == 'true'" />
  </PropertyGroup>
  
  <!-- As a get out of jail card, we let users turn off anything impactful, but their IDE won't really work. -->
  <ItemGroup Condition="'$(DisableAllRazorFilesAsAdditionalFiles)' != 'true' And '$(_HasRazorOrCshtmlFiles)' == 'true'">
    <AdditionalFiles Include="@(_RazorOrCshtmlFiles)" Condition="'@(_RazorOrCshtmlFiles)' != ''" />
  </ItemGroup>

  <ItemGroup Condition="'$(DisableAutomaticRazorSourceGeneratorReference)' != 'true' And '$(_HasRazorOrCshtmlFiles)' == 'true'">
    <!-- Since we know this file is only used in VS Code for the C# extension, locating the source generator is easy -->
    <Analyzer Include="..\Microsoft.CodeAnalysis.Razor.Compiler.dll" />
    <Analyzer Include="..\Microsoft.Extensions.ObjectPool.dll" />
    <Analyzer Include="..\Microsoft.AspNetCore.Razor.Utilities.Shared.dll" />
  </ItemGroup>

</Project>